<!DOCTYPE html>

<html lang="en-us">

<head>

  <meta charset="UTF-8">
  <title>War card Game</title>

  <!-- Bootstrap CDN-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">



</head>

<body>

  <div class="container">
    <style type="text/css">
      body{background: rgba(0, 0, 0, 0.6);}

      #mainContainer {
       margin: 10px;
       background: #E8E8E8;
       width: 50%;
      }
      button {
       height: 30px;
       width: 90px;
       background: #90EE90;
       border: 1px;
       border-style: solid;
       border-width: thin;
       margin-bottom: 10px;
      }
      .timer {
        color: red;
      }
      #GameGontainer {
       background: black;
       height: 500px;
       width: 50%;
       color: white;
      }
      .playercard {
       width: 80px;
       height: 120px;
       background: red;
       margin: 10px
      }
      .drawcnt {
       background: green;
       width: 50%;
      }
      .gameidDiv {
       background: green;
       width: 50%;
     }
    </style>
    <br>



      <!-- <div class="row">
        <div class="col-lg-12">
          <div class="card card-default">
            <div class="card-body">
              <h3 class="text-center"><strong>Today's Sale</strong>: Pure Vegetarian-Based Coding Knowledge (Chewable)</h3>
            </div>
          </div>
        </div>
      </div> -->
    </div>

      <!-- Current Product -->
      <!-- <div class="row">
        <div class="col-lg-12">
          <div class="card card-default">
            <div class="card-body">
              <div class="row">
                <div class="col-sm-4 col-sm-offset-2">
                  <img class="img-fluid thumbnail center-block" src="http://graphitepublications.com/wp-content/uploads/2015/04/5-Coding-Challenges-to-Help-You-Train-Your-Brain.jpg" alt="Coding Brain" >
                </div>
                <div class="col-sm-6">
                  <h3 class=""><strong>Highest Bidder:</strong> <span id="highest-bidder"></span></h3>
                  <h3 class=""><strong>Current Price:</strong> <span id="highest-price"></span></h3>
                  <hr>
                  <h3 class="">Hurry! <strong><span id="connected-viewers"></span></strong> people have their eyes on the prize.</h3>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> -->
    </div>

      <!-- Make Your Bid -->
      <div class="row">
        <div class="col-lg-12">
          <div class="card card-default">
            <div class="card-heading">
              <h3 class="card-title"></h3>
              <button class="NewgameButton">New Game</button> or Enter Game ID<input type="text">
              <button Class="NewgameButton">Submit</button>
            </div>

            <!-- <div class="StartGame" id="mainContainer">
                <div class='player1'> </div>
                <div class='player2'> </div>
            </div> -->

            <div class="seconddiv">
            <center>
              <div id="GameGontainer" style="float: left;" > <h1>P1</h1>
                  <div class="gameidDiv"  style="float: left;"> <span>Game ID: </span><span class="gameid"></span></div>
                  <div class="p1drawcnt"> <span>Draws left: </span><span class="p1DrawingLeft"></span></div>
                  <div class="playercard"> </div>
                  <button class="drawbutton" id="player1"> Draw</button>
              </div>
            </center>

            <center>
              <div id="GameGontainer" style="float: right;" > <h1>P2</h1>
                <div class="gameidDiv"  style="float: left;"> <span>Game ID: </span><span class="gameid"></span></div>
                <div class="p2drawcnt"> <span>Draws left: </spaan><span class="p2DrawingLeft"></span></div>
                <div class="playercard"> </div>
                <button class="drawbutton" id="player2"> Draw</button>
              </div>
            </center>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <!-- Firebase Reference -->
  <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>

  <!-- Script -->
  <script type="text/javascript">
  $(".seconddiv").hide()
  var randomnumber = 0
  console.log('Begining')
  var config = {
    apiKey: "AIzaSyABXfW3CaD6D_dFhB0RWT_WK1qZcRFHDAc",
    authDomain: "rpstwopersons.firebaseapp.com",
    databaseURL: "https://rpstwopersons.firebaseio.com",
    storageBucket: "rpstwopersons.appspot.com"
  };
  firebase.initializeApp(config);

  // Get a reference to the database service
 var database = firebase.database();
 var connectionsRef = database.ref("/connections");
 var Util_id_tracker = database.ref("/util_id_tracker");


 function buildCard()
 {
 console.log('here i am')
   var randIndex

  for (var i = 0; i < 52; i++)
  {
    // console.log(faceValue.length)
    randIndex = Math.floor(Math.random()*faceValue.length);
    console.log('rand index is: '+ randIndex)
    console.log('rand Number is' + faceValue[randIndex])
    if(i%2 == 0)
    {
      p1.push(faceValue[randIndex])
    }
    else {
      p2.push(faceValue[randIndex])
    }
    faceValue.splice(randIndex, 1)
  }

 }

function getuniqueId()
{
  console.log('genrating RandNum')
  var randnum = Math.floor(Math.random()*100) + 1;
  if(gameids.length > 0)
  {
    for(k in gameids)
    {
      if(randnum == gameids[k])
      {
        console.log('already existing Number')
        getuniqueId()
      }
      else {
        return randnum
      }
    }
  }
else {
  return randnum
}

}
gameids = []
function initGame(tmp)
  {
    console.log($(tmp).text()  )
    if($(tmp).text() === 'New Game')
    {
      playerID = 1
      player = 'player1'
      var utilTrackerData = database.ref("util_id_trackerNew")
      utilTrackerData.once('value',function(snapshot)
      {
        console.log('====')
        snapshot.forEach(function(childsnapshot)
        {
          var childKey = childsnapshot.key;
          var childData = childsnapshot.val()
          console.log(childKey + " "+ childData.gamid)
          gameids.push(childsnapshot.val().gameid)
          console.log(gameids)

        });

        });

        var gameid = getuniqueId()

      console.log('New Game!!')
      console.log('creating util_id_tracker')
      var Util_id_tracker_id_trackerRef = database.ref().child("util_id_trackerNew");
      var Util_id_tracker_tbl = Util_id_tracker_id_trackerRef.push();
      Util_id_tracker_tbl.set({gameid: gameid})


      var gameIndexRef = database.ref().child("gameIndex_"+gameid)
      gameIndexRef.set({player1: score})
      buildCard()
      var cardIndexRef = database.ref().child("cardIndex_"+gameid)
      cardIndexRef.set({p1cards: p1})
      cardIndexRef.update({p2cards: p2})

    }
    else if ($(tmp).text() === 'Submit')
    {//if player submit gameid initialize game for player 2
      playerID = 2
      player = 'player2'
      var enteredGameId = $("input").val()
      gameid = enteredGameId
      console.log($("input").val())
      var gameIndexName = 'gameIndex_'+enteredGameId
        console.log(gameIndexName)
       var gametrackerIndexRef = database.ref().child(gameIndexName)
      gametrackerIndexRef.update({player2: player2_score+1})

    }

    $('.card-heading').hide()
    $('.seconddiv').show()
    $('.gameid').text(gameid)

    $("button").prop("disabled", true)
    $(".p1drawcnt").text(p1DrawingLeft)
    $(".p2drawcnt").text(p2DrawingLeft)
  if(playerID == 1)
  {
    console.log('!!!hello!!!' )
   $("#player1").prop("disabled", false)

  }
  else if(playerID  == 2)
  {
    console.log('!!!hallo!!!' )
    $("#player2").prop("disabled", false)

  }
  $(".drawbutton").on("click", function(){

          console.log('Started');

          if(playerID == 1)
          {
            console.log('helloo')
                  p1DrawingLeft--;

          }
          else if(playerID == 2 )
          {
                  console.log('hallooo')
                  p2DrawingLeft--;

          }
          $(".p1drawcnt").text(p1DrawingLeft)
          $(".p2drawcnt").text(p2DrawingLeft)
          if(p1DrawingLeft <=0 )
            {$("#player1").prop("disabled", true)}
          else if(p2DrawingLeft <=0 )
              {$("#player2").prop("disabled", true)}
////End TEMP:
});
}


p1 =[]
p2 =[]
faceValue = [2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14]
var player2_score = 0
var player = 'player1'
var score = 0
var playerID
var p1DrawingLeft = 10;
var p2DrawingLeft = 10;
  //Starts here
console.log('Starting Game')
//$('.NewgameButton').on('click', function(){
$('.NewgameButton').on('click', function(){

initGame($(this))

})





  </script>

</body>

</html>
